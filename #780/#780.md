任务：[LTP: 调研trace_sched01失败问题 #780](https://github.com/openEuler-RISCV/oerv-team/issues/780)

https://github.com/openEuler-RISCV/QA/tree/main/testreport/24.03/round1/performance-test/ltp_function

```
<<<test_start>>>
tag=trace_sched01 stime=1714364833
cmdline="trace_sched -c 1"
contacts=""
analysis=exit
<<<test_output>>>
main(): sched_setscheduler(): Operation not permitted
main(): sched_setscheduler(): Operation not permitted
main(): sched_setscheduler(): Operation not permitted
...
```

---

参考 [openEuler社区测试能力执行指南](https://gitee.com/openeuler/QA/blob/master/openEuler%E7%A4%BE%E5%8C%BA%E6%B5%8B%E8%AF%95%E8%83%BD%E5%8A%9B%E6%89%A7%E8%A1%8C%E6%8C%87%E5%8D%97/openEuler%E7%A4%BE%E5%8C%BA%E6%B5%8B%E8%AF%95%E8%83%BD%E5%8A%9B%E6%89%A7%E8%A1%8C%E6%8C%87%E5%8D%97.md) 下载 [ltp源码]([https://github.com/linux-test-project/ltp](https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Flinux-test-project%2Fltp)) 和 [ltp脚本](https://gitee.com/openeuler/test-tools/tree/master/kernel-testsuite/ltp)

报错: 进入`test-tools/kernel-testsuite/ltp`执行脚本`sh start_ltp_test.sh` 软件源被偷换

解决: 恢复默认软件源, 参考 [在openEuler上执行ltp测试](https://gitee.com/openeuler/test-tools/blob/master/ltp/%E5%9C%A8openEuler%E4%B8%8A%E6%89%A7%E8%A1%8Cltp%E6%B5%8B%E8%AF%95.md#%E5%9C%A8openeuler%E4%B8%8A%E6%89%A7%E8%A1%8Cltp%E6%B5%8B%E8%AF%95) 逐步安装编译(成功)

shh登陆

```bash
ssh -p 12055 root@127.0.0.1
```

1.获取ltp测试套件

```shell
git clone https://github.com/linux-test-project/ltp.git
```

2.安装依赖

```shell
yum -y install gcc git make pkgconf autoconf automake bison flex m4 kernel-headers glibc-headers
```

```shell
yum -y install clang findutils libtirpc libtirpc-devel pkg-config openeuler-lsb
```









Linux Test Project (LTP) ，LTP是一个用于验证Linux内核特性和行为正确性的测试套件。该测试旨在检查调度器跟踪功能，但遇到了权限问题。

[LTP学习笔记(基本安装+执行)](https://blog.csdn.net/weixin_41477689/article/details/118607624)

[gitcode/linux-test-project](https://gitcode.com/linux-test-project/ltp/overview)









从您提供的信息来看，这个问题是关于Linux Test Project (LTP) 中`trace_sched01`测试用例失败的情况。

### 分析要点：

1. **错误信息**："sched_setscheduler(): Operation not permitted" 表明程序尝试调用`sched_setscheduler()`系统调用来改变进程的调度策略或优先级时失败了。这个错误通常意味着调用进程没有足够的权限执行此操作。

2. **原因猜测**：
   - **权限不足**：最直接的原因是执行测试的用户或环境没有必要的CAP_SYS_NICE能力，这个能力允许改变进程的优先级和调度策略。在大多数Linux系统中，只有root用户或具有特定权限的用户才能执行这类操作。
   - **SELinux/AppArmor限制**：如果系统启用了SELinux或AppArmor安全模块，它们可能限制了进程对某些系统调用的访问，即使是以root身份运行也不例外。
   - **Cgroups限制**：如果测试进程运行在特定的Control Groups (cgroups) 中，cgroups的配置可能限制了进程调度策略的修改。

3. **解决思路**：
   - **提升权限**：确保测试以root权限执行，或者为执行测试的用户赋予CAP_SYS_NICE能力。
   - **检查安全策略**：如果系统使用SELinux或AppArmor，检查相应的策略配置，必要时调整策略以允许测试执行所需的系统调用。
   - **调整cgroups设置**：如果测试环境使用cgroups，检查并适当修改cgroups的配置，确保不会限制调度策略的更改。
   - **修改测试脚本**：作为最后的手段，如果无法直接解决权限问题，可以考虑修改测试脚本以规避直接调用`sched_setscheduler()`，但这可能影响测试的准确性。

### 实施建议：

- 首先，确认测试是否必须以非root用户或受限环境执行。如果不是，简单地以root权限重新执行测试可能是最快捷的解决方案。
- 如果出于安全或管理原因不能直接提升权限，应深入研究系统的安全策略配置，寻找合适的调整方案。
- 在进行任何系统级权限更改之前，务必评估其对系统安全性和稳定性的影响。

希望这些分析和建议能帮助您解决问题。如果有更详细的系统环境信息或进一步的错误日志，可能有助于进行更精确的诊断。
